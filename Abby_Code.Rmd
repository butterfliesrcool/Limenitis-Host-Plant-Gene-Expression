---
title: "Abby_Code"
author: "Abby Robinson"
date: "7/12/2022"
output: html_document
---

Load Libraries
```{r}
library(curl)
library(survival)
library(survminer)
library(ggplot2)
```

Load caterpillar development data using the "curl" command 
```{r}
d <- curl("https://raw.githubusercontent.com/butterfliesrcool/Limenitis-Host-Plant-Gene-Expression/main/caterpillar.dev.data.csv")
dev <- read.csv(c, header = TRUE, sep = ",", stringsAsFactors = FALSE)
dev
length(dev$caterpillar.length)
```

Remove NA data 
```{r}
dev <- na.omit(dev)
length(dev$caterpillar.length)
```

Summary Stats 
Code Source: https://r-coder.com/aggregate-r/
```{r}
only.cats <- subset(dev, stage == "caterpillar", drop = FALSE)

sum.stats <- aggregate(x= only.cats$caterpillar.length, by= list(only.cats$date, only.cats$host.plant), FUN=mean)
colnames(sum.stats)[1] <- "Date"
colnames(sum.stats)[2] <- "Host-Plant"
colnames(sum.stats)[3] <- "Caterpillar-Length(mm)"
sum.stats
```

```{r}
aspen <- subset(sum.stats, sum.stats[2] == "aspen", drop = FALSE)
aspen
aspen$`Caterpillar-Length(mm)`
```

```{r}
cherry <- subset(sum.stats, sum.stats[2] == "cherry", drop = FALSE)
cherry
cherry$`Caterpillar-Length(mm)`
```

```{r}
aspen[1]
```

```{r}
df <- data.frame(
  date = aspen[1],
  aspen = aspen$`Caterpillar-Length(mm)`,
  cherry = cherry$`Caterpillar-Length(mm)`
)

growth <- t(cbind(df$aspen, df$cherry))

barplot(growth, beside=T, names.arg = df$date, col=c("black","grey"))
```
**Survival Analysis**
Within the package "Survival" we can use the function "Surv" to create a Survival object. We can then use the function "survfit" to generate the rate of pupation 
Code Source: https://www.emilyzabor.com/tutorials/survival_analysis_in_r_tutorial.html
```{r}
pup.rate <- survfit(Surv(dev.days, status) ~ host.plant, data = dev)
summary(pup.rate)
```


Cox proportional-hazards regression model 
```{r}
coxph(Surv(dev.days, status) ~ host.plant, data=dev)
```

The pairwise_survdiff() function is another way to generate pairwise comparisons in the survival/pupation differences between individuals reared on different host plants 
```{r}
survdiff(Surv(dev.days, status) ~ host.plant, data=dev)
pairwise_survdiff(Surv(dev.days, status) ~ host.plant, p.adjust.method = "BH",
     data = dev)
```

```{r}
ggsurvplot(
    fit = survfit(Surv(dev.days, status) ~ host.plant, data = dev), 
    xlab = "Days to Pupation", 
    ylab = "Rate of Pupation")
```
R Module for making pretty figures in ggplot: https://www.cedricscherer.com/2019/08/05/a-ggplot2-tutorial-for-beautiful-plotting-in-r/

